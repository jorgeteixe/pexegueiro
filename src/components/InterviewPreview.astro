---
import { getCollection } from 'astro:content'
import { Icon } from 'astro-icon/components'

interface Props {
  interviewSlugs: string[]
}

const { interviewSlugs } = Astro.props

// Get interview entries
const allInterviews = await getCollection('entrevistas')
const interviews = interviewSlugs
  .map((slug) => allInterviews.find((interview) => interview.slug === slug))
  .filter(Boolean)
---

{
  interviews.length > 0 && (
    <div class="mt-8">
      <h3 class="mb-4 flex items-center text-xl font-semibold text-gray-900">
        <Icon name="mdi:microphone" class="mr-2 h-5 w-5" />
        Qué nos contan os nosos maiores?
      </h3>

      <div class="space-y-4">
        {interviews.map(async (interview) => {
          if (!interview) return null

          const { Content } = await interview.render()

          return (
            <div class="rounded-lg border border-gray-200 bg-white p-6 transition-colors hover:border-gray-300">
              <div class="flex items-start space-x-4">
                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 text-blue-800">
                  <Icon name="mdi:microphone" class="h-5 w-5" />
                </div>

                <div class="min-w-0 flex-1">
                  <div class="mb-2 flex items-start justify-between">
                    <h4 class="text-lg font-semibold text-gray-900">
                      {interview.data.title}
                    </h4>
                    <a
                      href={`/entrevistas/${interview.slug}`}
                      class="ml-4 flex flex-shrink-0 items-center text-sm font-medium text-blue-600 hover:text-blue-800"
                    >
                      Ver entrevista
                      <Icon name="mdi:arrow-right" class="ml-1 h-4 w-4" />
                    </a>
                  </div>

                  <div class="mb-3 space-y-1">
                    {interview.data.entrevistado && (
                      <div class="flex items-center text-sm text-gray-600">
                        <Icon name="mdi:account" class="mr-1 h-4 w-4" />
                        <span>{interview.data.entrevistado}</span>
                        {interview.data.idade && (
                          <span class="ml-1 text-gray-400">
                            ({interview.data.idade} anos)
                          </span>
                        )}
                      </div>
                    )}
                  </div>

                  <div class="prose prose-sm line-clamp-3 max-w-none text-sm text-gray-600">
                    <Content />
                  </div>

                  {interview.data.temas && interview.data.temas.length > 0 && (
                    <div class="mt-3">
                      <div class="flex flex-wrap gap-1">
                        {interview.data.temas.slice(0, 3).map((tema) => (
                          <span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-1 text-xs font-medium text-gray-700">
                            {tema}
                          </span>
                        ))}
                        {interview.data.temas.length > 3 && (
                          <span class="px-2 py-1 text-xs text-gray-500">
                            +{interview.data.temas.length - 3} máis
                          </span>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          )
        })}
      </div>
    </div>
  )
}

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
