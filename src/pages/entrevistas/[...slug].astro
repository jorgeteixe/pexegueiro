---
import { getCollection } from 'astro:content'
import { Icon } from 'astro-icon/components'
import Layout from '../../layouts/Layout.astro'
import Header from '../../components/Header.astro'
import Footer from '../../components/Footer.astro'

export async function getStaticPaths() {
  const entrevistasEntries = await getCollection('entrevistas')
  return entrevistasEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { Content } = await entry.render()
---

<Layout title={entry.data.title}>
  <div class="flex min-h-screen flex-col">
    <Header />

    <main class="flex-grow bg-gray-50">
      <div class="mx-auto max-w-4xl px-4 py-8 sm:px-6">
        <!-- Header Section -->
        <div class="mb-8">
          <div class="rounded-lg border border-gray-200 bg-white p-8">
            <div class="mb-6 flex items-start justify-between">
              <div class="flex-1">
                <h1 class="mb-2 text-3xl font-bold text-gray-900 sm:text-4xl">
                  {entry.data.title}
                </h1>

                <!-- Updated Date -->
                <div class="flex items-center text-sm text-gray-500">
                  <Icon name="mdi:update" class="mr-1 h-4 w-4" />
                  Actualizado o {
                    entry.data.updatedDate.toLocaleDateString('gl-ES')
                  }
                </div>
              </div>

              <!-- Interview Type Badge -->
              <div class="flex-shrink-0">
                <div
                  class="inline-flex items-center rounded-full bg-blue-100 px-4 py-2 text-sm font-medium text-blue-800"
                >
                  <Icon name="mdi:microphone" class="mr-2 h-4 w-4" />
                  Entrevista
                </div>
              </div>
            </div>

            <!-- Interview Info Cards -->
            <div class="grid gap-4 sm:grid-cols-2">
              {
                entry.data.entrevistado && (
                  <div class="rounded-lg bg-gray-50 p-6">
                    <div class="flex items-center">
                      <Icon
                        name="mdi:account"
                        class="mr-3 h-5 w-5 text-gray-400"
                      />
                      <div>
                        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">
                          Entrevistado
                        </p>
                        <p class="text-sm font-medium text-gray-900">
                          {entry.data.entrevistado}
                        </p>
                      </div>
                    </div>
                  </div>
                )
              }

              {
                entry.data.idade && (
                  <div class="rounded-lg bg-gray-50 p-6">
                    <div class="flex items-center">
                      <Icon
                        name="mdi:calendar"
                        class="mr-3 h-5 w-5 text-gray-400"
                      />
                      <div>
                        <p class="text-xs font-medium uppercase tracking-wider text-gray-500">
                          Idade
                        </p>
                        <p class="text-sm font-medium text-gray-900">
                          {entry.data.idade} anos
                        </p>
                      </div>
                    </div>
                  </div>
                )
              }
            </div>

            <!-- Topics -->
            {
              entry.data.temas && entry.data.temas.length > 0 && (
                <div class="mt-6">
                  <h3 class="mb-2 text-sm font-medium text-gray-700">
                    Temas tratados:
                  </h3>
                  <div class="flex flex-wrap gap-2">
                    {entry.data.temas.map((tema: string) => (
                      <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">
                        {tema}
                      </span>
                    ))}
                  </div>
                </div>
              )
            }
          </div>
        </div>

        <!-- Interview Content -->
        <div class="rounded-lg border border-gray-200 bg-white p-8">
          <div class="prose prose-lg prose-gray max-w-none">
            <Content />
          </div>
        </div>
      </div>
    </main>

    <Footer />
  </div>
</Layout>
